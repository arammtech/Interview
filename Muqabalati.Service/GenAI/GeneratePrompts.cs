using Muqabalati.Service.DTOs;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace Muqabalati.Service.GenAI
{
    public static class GeneratePrompts
    {
        public static string GenerateReportPrompt(List<AnswerModel> answers, string[] questions)
        {
            return $@"
يرجى تحليل البيانات التالية المستندة إلى مقابلة حقيقية مع مراعاة أن الإجابة يجب أن تكون منطقية وصحيحة 
وأيضًا إذا كانت الإجابة فارغة أو لم يجب فاعتبرها خاطئة. مع الاهتمام أيضًا إذا كان فيها قدر من الأشياء 
الصحيحة أن تعتبرها صحيحة أو إذا قالها بطريقة غير مرتبة أو أن الإجابة تدل على فهم المتقدم، مع تجنب قبول 
إجابات غير دقيقة أو غامضة مثل ""هذا السؤال الأول"". وإرجاع النتائج بالتنسيق التالي:

<تقييم>
    0. [هل نجح ام رسب مع اخذ بعين الاعتبار الاسئلة المهمة او المهارات الناعمة بناءا على شركة حقيقية(true or false) فقط قم بارجاع]
    1. [عدد الإجابات الصحيحة (int) فقط قم بارجاع]
    2. [عدد الإجابات الخاطئة (int) فقط قم بارجاع]
    3. [نسبة النجاح (int) فقط قم بارجاع]
    4. <توصيات>
        <توصية>
            <نص>
                [نص التوصية المحددة لتحسين الأداء بدون أي علامات مثل الاستفهام أو النقاط أو الفواصل 
                أو الشرطات أو أي رموز أخرى]
            </نص>
            <مصدر>
                   [مصدر المعلومات الموثوقة المستخدمة لإعطاء التوصية اذا لم يكن هناك مصدر ارجع القيمة فارغة]
            </مصدر>
        </توصية>
        **يجب الالتزام بما يلي:**
        * [قم بإضافة 3 توصيات على الأقل مع توفير مصادر موثوقة مكتوبة]
        * [تأكد من أن المصادر المكتوبة ليست صفحة 404 أو لا تحتوي على معلومات مفقودة]
        * [إذا كانت جميع أو بعض الإجابات خاطئة أو فارغة، قم بإعطاء توصيات بناءً على الأسئلة 
        التي لم يُجب عنها أو كانت إجابته ضعيفة]
        * [اجعل نص التوصية لا يتجاوز 100 كلمة]
        * [تأكد من أن المصادر التي تختارها مفيدة وذات مصداقية عالية]
    </توصيات>
</تقييم>

بيانات المقابلة:
{PrintQuestionsAndAnswers(questions, answers)}
";
        }



        public static string GenerateIntroPrompt(
                  string applicantName,
                  string interviewerName,
                  string topic,
                  string tone,
                  string level,
                  string interviewLanguage)
        {
            return $@"
                                  صِغ تحية ودية تُستخدم في بداية مقابلة مع متقدم. يجب أن تتضمن التحية:

                * الترحيب بالمتقدم بشكل لائق.

                * تعريف النظام أو الشخص الذي يجري المقابلة.

                * تقديم توجيهات بسيطة ومشجعة حول كيفية الإجابة.


                * إخباره بأن لديه وقتًا معينًا سيظهر أمامه للإجابة على كل سؤال. 

                * إخباره بأن لديه  ازرار  في الشاشة لتساعده لاعادة السؤال او للتوضيح او الانتقال الى السؤال التالي بصياغة ودية

                * اخبرة 'الان  المقابلة ستبدا' بصياغة ودية .



                تفاصيل السياق:
                * اسم الشركة : مقابلتي

                * اللغة: {interviewLanguage}

                * اللهجة: {tone}

                * اسم المتقدم: {applicantName}

                * اسم المحاور: {interviewerName}

                * الموضوع: {topic}

                * المستوى المطلوب: {level}

                النص يجب أن يكون:
                * الحفاظ على أسلوب ودي ومهني.
                * واضحًا ومباشرًا.
                * خاليًا من أي رموز أو تعليمات تحتاج إلى معالجة و  خاليا من علامات النحو وغيرها من العلامات التنصيص او  الفواصل او بدء سطر جديد
                * استعمل نقطة بين الجمل
                * جاهزًا للاستخدام فورًا مع Web Speech AI.
";
        }


        public static string GenerateConclusionPrompt(
            string applicantName,
            string tone,
            string interviewLanguage)
        {
            return $@"
                صِغ خاتمة ودية تُستخدم لإنهاء مقابلة مع متقدم. يجب أن تتضمن الخاتمة:

                * شكر المتقدم باسمه ({applicantName}) على وقته وجهوده أثناء المقابلة.
                * الإشارة إلى أنه سيتم نقله إلى صفحة النتائج خلال ثوانٍ قليلة، حيث يمكنه الاطلاع على تقييمه النهائي.
                * الحفاظ على أسلوب ودي ومشجع لإنهاء المقابلة بانطباع إيجابي.
                * استخدام اللهجة: {tone}.
                                تفاصيل السياق:

                * اللغة: {interviewLanguage}

                * اللهجة: {tone}

                * اسم المتقدم: {applicantName}


                النص يجب أن يكون:
                * الحفاظ على أسلوب ودي ومهني.
                * واضحًا ومباشرًا.
                * خاليًا من أي رموز أو تعليمات تحتاج إلى معالجة و  خاليا من علامات النحو وغيرها من العلامات التنصيص او الفواصل او بدء سطر جديد
                * استعمل نقطة بين الجمل
                * جاهزًا للاستخدام فورًا مع Web Speech AI.
    ";
        }

        public static string PrintQuestionsAndAnswers(string[] questions, List<AnswerModel> answers)
        {
            if (questions.Length != answers.Count)
            {
                throw new ArgumentException("عدد الأسئلة يجب أن يتطابق مع عدد الإجابات.");
            }

            var result = new StringBuilder();

            for (int i = 0; i < questions.Length; i++)
            {
                answers[i].Answer = string.IsNullOrEmpty(answers[i].Answer) ? "اعتبرها اجابة خاطئة" : answers[i].Answer;
                result.AppendLine($"السؤال {i + 1}: {questions[i]}");
                result.AppendLine($"الإجابة: {answers[i].Answer}");
                result.AppendLine(); // مسافة بين كل سؤال وإجابته
            }

            return result.ToString();
        }


        public static string GenerateQuestionPrompt(
          int questionNum,
          string topic,
          string level,
          string tone,
          string terminologyLanguage,
          string interviewLanguage)
        {
            return $@"
أنشئ لي قائمة بـ {questionNum} سؤال مقابلة حقيقي، قم سحب عشوائي مع التوزيع (Shuffle): من بنك أسئلة مكون من مابين 75 الى 120 سؤال غير مكرر مصنف حسب الموضوع. يجب أن تتضمن هذه القائمة أسئلة تقنية (مهنية) وأسئلة تقيس مهارات مثل العمل الجماعي، وكيفية حل المشكلات، وكل ذلك يجب أن يكون مرتبطًا بموضوع المقابلة ايضا قم بـ :
                    1. إضافة كلمة تمهيدية تربط كل سؤال بالسؤال السابق 

                       (مثل: ""وبعد ذلك، دعنا ننتقل إلى..."" أو ""في نفس السياق، سأسأل...""أو ""السؤال الاول هو"" أو ""بالإضافة إلى ذلك..."" ولا تقتصر على هذه الامثلة فقط ولكن مع الاهتمام باللهجة ايضا قم باختيار كلمات ربط بشكل عشوائي والاهتمام في اختيار كلمة الربط المناسبة حسب ترتيب الاسئلة دون اخبارة بجودة اجابتة او هل هي صحيحة ام لا).  

2.  صياغة السؤال الأساسي بدقة ووضوح.
3.  إعادة صياغة السؤال بكلمات مختلفة مع الحفاظ على المعنى.
    * يفضل إضافة أمثلة توضيحية إذا كان ذلك مناسبًا.
4.  تقديم تفسير أو توضيح للسؤال لمساعدة المتقدم على فهم المطلوب.
    * يفضل إضافة أمثلة عملية إذا كانت متاحة.
5.  تقدير الوقت المطلوب للإجابة على السؤال بالدقائق.

متطلبات الأسئلة:

* الأسئلة يجب أن تكون واضحة ومباشرة.
* ذات صلة بالسياق التالي:
    * الموضوع: {topic}.
    * اللغة: {interviewLanguage}.
    * المستوى المطلوب: {level}.
    * مكتوبة بلهجة {tone} مع استخدام المصطلحات التقنية باللغة {terminologyLanguage}.
* يجب أن تتبع الأسئلة التنسيق التالي:

    <سؤال>
    1.  [ اختيار كلمة الرابط المناسبة حسب ترتيب السؤال دون ذكر كلام ايجابي او سلبي او يوحي بان لدية خبرة سابقة وانما تكون مجرد اداءة ربط]
    2.  [السؤال الأصلي  فواصل او علامات تنصيص مثل ' او ""]
    3.  [إعادة الصياغة مع أمثلة إذا لزم الأمر  فواصل]
    4.  [التوضيح مع أمثلة عملية ولكن على شكل سؤال ولا تقم باعطاءة الااجابة انما مساعدة اضافية إذا أمكن  فواصل]
    5.  [الوقت المحتمل للإجابة بالدقائق، الرقم فقط]
    </سؤال>
* الأسئلة نظرية ولا تتطلب أي إجراءات عملية.

النص الناتج يجب أن يلتزم بالمعايير التالية:

1.  **وضوح النص ومباشرته:**
    * يجب أن يكون النص بسيطًا وخاليًا من التعقيد.
2.  **خلو النص من الرموز والعلامات غير الضرورية:**
    * لا يُسمح باستخدام علامات التنصيص مثل: ` أو '.
    * استعمل نقطة بين الجمل
    * يجب تجنب النقاط الزائدة أو أي رموز أخرى أو علامات النحو مثل الفاصلة وغيرها.
3.  **التنسيق المعتمد:**
    * النص يجب أن يلتزم بالشكل التالي فقط:

  <سؤال>
    1.  [ اختيار كلمة الرابط المناسبة حسب ترتيب السؤال دون ذكر كلام ايجابي مثل : احسنت، تمام جدا، اجابة صحيح او سلبي او يوحي بان لدية خبرة سابقة وانما تكون مجرد اداءة ربط]
    2.  [السؤال الأصلي بدون  فواصل او علامات تنصيص مثل ' او ""]
    3.  [إعادة الصياغة مع أمثلة إذا لزم الأمر  فواصل]
    4.  [التوضيح مع أمثلة عملية ولكن على شكل سؤال ولا تقم باعطاءة الااجابة انما مساعدة اضافية إذا أمكن  فواصل]
    5.  [الوقت المحتمل للإجابة بالدقائق، الرقم فقط]
    </سؤال>
4.  **سهولة الاستخدام:**
    * يجب أن يكون النص جاهزًا للاستخدام الفوري دون الحاجة إلى أي معالجة إضافية.
5.  **استثناءات التنسيق:**
    * الاستثناءات الوحيدة المسموح بها هي تنسيقات الفقرات والعناصر داخل إطار: `<سؤال>` كما هو محدد أعلاه.

النص الناتج عن هذه المعايير سيكون ملائمًا لأي تطبيق تقني دون الحاجة إلى معالجة إضافية، وسيسهل العمل معه بشكل مباشر.

لا تحذف هذا الفورمات لكي أستطيع فصل الأسئلة مع أجزائها أو الفواصل.

النص يجب أن يكون جاهزًا للاستخدام فورًا مع Web Speech AI.
                        ";
        }

    }
}
